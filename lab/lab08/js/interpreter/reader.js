function Pair(e,t){var n=this;this.first=e;this.second=t;this.length={valueOf:function(){return n.getlength()},toString:function(){return n.getlength().toString()}}}function Buffer(e){this.line_index=0;this.index=0;this.source=e;this.current_line=[];this.current()}function scheme_read(e){var t,n;if(e.current()===null){throw"EOFError"}t=e.pop();if(t==="nil"){return nil}else if(!DELIMITERS.inside(t)){return t}else if(t==="'"){n=scheme_read(e);return new Pair("quote",new Pair(n,nil))}else if(t==="("){return read_tail(e)}else{throw"SyntaxError: unexpected token: "+t}}function read_tail(e){var t,n,r,i;if(e.current()===null){throw"SyntaxError: unexpected end of file"}if(e.current()===")"){e.pop();return nil}if(e.current()==="."){e.pop();r=scheme_read(e);i=e.pop();if(i!=")"){throw"SyntaxError: Expected one element after ."}return r}t=scheme_read(e);n=read_tail(e);return new Pair(t,n)}Pair.prototype={valueOf:function(){return"Pair("+this.first.valueOf()+", "+this.second.valueOf()+")"},toString:function(){var e="("+(this.first===undefined?"undefined":this.first.toString());var t=this.second;while(t instanceof Pair){e+=" "+t.first.toString();t=t.second}if(t!==nil){e+=" . "+t.toString()}return e+")"},getlength:function(){var e=1;var t=this.second;while(t instanceof Pair){e+=1;t=t.second}if(t!==nil){throw"TypeError: length attempted on improper list"}return e},getitem:function(e){if(e<0){throw"IndexError: negative index into list"}var t=this;for(var n=0;n<e;n++){if(t.second===nil){throw"IndexError: list out of bounds"}else if(!(t.second instanceof Pair)){throw"TypeError: ill-formed list"}t=t.second}return t.first},seperate_dotted:function(){if(!(this.second instanceof Pair)){return[new Pair(this.first,nil),this.second]}else{var e=this.second.seperate_dotted();var t=e[0];var n=e[1];return[new Pair(this.first,t),n]}},map:function(e){var t=e(this.first);if(this.second===nil||this.second instanceof Pair){return new Pair(t,this.second.map(e))}else{throw"TypeError : ill-formed list"}}};var nil={valueOf:function(){return"nil"},toString:function(){return"()"},length:0,getitem:function(e){if(e<0){throw"IndexError: negative index into list"}throw"IndexError: list index out of bounds"},map:function(e){return this}};Buffer.prototype={pop:function(){var e=this.current();this.index+=1;return e},more_on_line:function(){return this.index<this.current_line.length},current:function(){while(!this.more_on_line()){this.index=0;if(this.line_index<this.source.length){this.current_line=this.source[this.line_index];this.line_index+=1}else{this.current_line=[];return null}}return this.current_line[this.index]}}
