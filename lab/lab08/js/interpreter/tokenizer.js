function SchemeString(e){this.str=e;this.length=e.length}function valid_symbol(e){if(e.length==0||!_SYMBOL_STARTS.inside(e.charAt(0))){return false}for(var t=1;t<e.length;t++){if(!_SYMBOL_INNERS.inside(e.charAt(t))){return false}}return true}function next_candidate_token(e,t){while(t<e.length){var n=e[t];if(n===";"){return[null,e.length]}else if(_WHITESPACE.inside(n)){t+=1}else if(_SINGLE_CHAR_TOKENS.inside(n)){return[n,t+1]}else if(n==="#"){return[e.slice(t,t+2),Math.min(t+2,e.length)]}else if(n==='"'){var r=t;var i="";while(r<e.length){i+=e[r];r+=1;if(e[r]==='"'){break}else if(e[r]===ESCAPE){r+=1}}return[i,r+1]}else{var s=t;while(s<e.length&&!_TOKEN_END.inside(e[s])){s+=1}return[e.slice(t,s),Math.min(s,e.length)]}}return[null,e.length]}function tokenize_line(e){var t=[];var n=next_candidate_token(e,0);var r=n[0];var i=n[1];while(r!=null){if(DELIMITERS.inside(r)){t.push(r)}else if(r==="+"||r==="-"){t.push(r)}else if(r==="#t"||r.toLowerCase()==="true"){t.push(true)}else if(r==="#f"||r.toLowerCase()==="false"){t.push(false)}else if(r==="nil"){t.push(r)}else if(r[0]==='"'&&r.length>0){t.push(new SchemeString(r.slice(1)))}else if(_NUMERAL_STARTS.inside(r[0])){var s=parseFloat(r);if(s==NaN){throw"ValueError: invalid numeral: "+r}else{t.push(s)}}else if(_SYMBOL_STARTS.inside(r[0])&&valid_symbol(r)){t.push(r)}else{throw"SyntaxError: invalid token:"+r}n=next_candidate_token(e,i);r=n[0];i=n[1]}return t}function tokenize_lines(e){return e.map(tokenize_line)}Array.prototype.inside=function(e){if(this.indexOf(e)==-1){return false}else{return true}};Array.prototype.map=function(e){var t=this.length;var n=new Array(t);for(var r=0;r<t;r++){n[r]=e(this[r])}return n};SchemeString.prototype={valueOf:function(){return"SchemeString("+this.str+")"},toString:function(){return this.str},substring:function(e,t){return this.str.slice(e,t)},getchar:function(e){if(e>=this.length||e<0){throw"SchemeError: index "+e+" out of range"}return this.str[e]}};var DIGITS="0123456789".split("");var ASCII_LOWERCASE="abcdefghijklmnopqrstuvwxyz".split("");var ASCII_UPPERCASE="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");var ASCII_LETTERS=ASCII_LOWERCASE.concat(ASCII_UPPERCASE);var _SYMBOL_STARTS="!$%&*/:<=>?@^_~".split("").concat(ASCII_LETTERS);var _SYMBOL_INNERS=_SYMBOL_STARTS.concat(DIGITS,"+-.".split(""));var _NUMERAL_STARTS=DIGITS.concat("+-.".split(""));var _WHITESPACE=" 	\n\r".split("");var _SINGLE_CHAR_TOKENS="()'".split("");var _TOKEN_END=_WHITESPACE.concat(_SINGLE_CHAR_TOKENS);var DELIMITERS=_SINGLE_CHAR_TOKENS.concat(["."]);var ESCAPE="\\"
